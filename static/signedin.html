<!DOCTYPE html>
<html>
  <head>
    <title>Home &mdash; Fitbit Completer </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


    <link href="reset.css" rel="stylesheet" type="text/css">
    <link href="style.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div id="container">
      <div id="header" class="box">
        <a id="home" href="/signedin.html"><img src="fitbit.png" alt="Fitbit" /> Completer</a>
      </div>

      <div class="content box">
        <p>Welcome to Fitbit Completer, where you can easily find ways to complete your Fitbit goals.</p>

        <p>
          Fitbit helps challenge you to take a certain number of steps every day and eat and exercise healthily, but it
          tends to do this in an un-actionable way. Do you really know how many steps away Starbucks is or how many calories
          14 push-ups burns?
        </p>

        <p>
          We'll help you by converting abstract goals like "1300 steps" or "eat 400 calories" to real-world
          ones like "walk to Central Park and back" or "try one serving of spinach". Good luck!
        </p>
      </div>



      <a href="steps.html" class="content box block" id="remainingSteps">
      </a>
      <a href="calories.html" class="content box block" id="remainingCalories">
      </a>
      <a href="activity.html" class="content box block">
        Touch here to find activities to unlock extra calories.
      </a>

<!-- TODO: fix footer scrolling bug -->
    <div id="footer">
      <div id="current-page" class="tab"><a href="signedin.html">Home</a></div>
      <div class="tab"><a href="steps.html">Steps</a></div>
      <div class="tab"><a href="calories.html">Calories</a></div>
      <div class="tab"><a href="activity.html">Activity</a></div>
    </div>


  <script src="jquery-1.9.0.js"></script>
  <script>
  var g = {};

  window.onload = function() {
    console.log("Hey");
    $.ajax({
      type: "get",
      url: "finalize-fitbit-oauth",
      data: {
        oauthTokenSecret: localStorage["fitbitCompleter" + "oauthTokenSecret"],
        callbackId: localStorage["fitbitCompleter" + "callbackId"]
      },
      success: function(response) {
        if (response.success) {
          localStorage["fitbitCompleter" + "AccessToken"] = response.accessToken;
          localStorage["fitbitCompleter" + "AccessTokenSecret"] = response.accessTokenSecret;
          localStorage["fitbitCompleter" + "UserID"] = response.userId;
        } else {
          console.log(response.error);
        }

        getFitbitData();
      }
    });

    function getFitbitData() {
      $.ajax({
        type: "get",
        url: "get-fitbit-data",
        data: {
          accessToken: localStorage["fitbitCompleter" + "AccessToken"],
          accessTokenSecret: localStorage["fitbitCompleter" + "AccessTokenSecret"]
        },
        success: function(response) {
          if (response.success) {
            g.caloriesGoal = response.caloriesGoal;
            g.actualCalories = response.actualCalories;
            g.goalSteps = response.goalSteps;
            g.actualSteps = response.actualSteps;
          } else {
            g.caloriesGoal = 2000;
            g.actualCalories = 200;
            g.goalSteps = 5000;
            g.actualSteps = 500;
          }

          displayUserData();
        }
      });
    }

    function displayUserData(){
      var steps = $("#remainingSteps");
      var calories = $("#remainingCalories");

      if(!g.goalSteps || (g.goalSteps - g.actualSteps) < 0){
        steps.html("You've completed your steps goal for the day, but if you want to go somewhere, click here!");
      }
      else{
        steps.html("You have " + (g.goalSteps - g.actualSteps) + " steps remaining today. Click here to find places to go to complete this goal!");
      }

      if(!g.caloriesGoal || (g.caloriesGoal - g.actualCalories) < 0){
        calories.html("You've eaten all your calories for the day, but I guess if you're still REALLY hungry you can click here.");
      }
      else{
        calories.html("You have " + (g.caloriesGoal - g.actualCalories) + " calories remaining today. Click here to find food to complete thsi goal!");
      }

      console.log(g.goalSteps);
      console.log(g.actualSteps);

      // sSpan.html(g.goalSteps - g.actualSteps);
      // cSpan.html(g.caloriesGoal - g.actualCalories);
    }

        /*navigator.geolocation.getCurrentPosition(function(position) {
          var myLongitude = position.coords.longitude;
          var myLatitude = position.coords.latitude;

            $.ajax({
              type: "get",
              url: "../foursquare-venues/" + myLatitude + "," + myLongitude + "," + "asianfood",
              success: function(response) {
                console.log("success: " + response.results);
              },
              dataType: "json"
            });
  });*/
  };
  </script>
  </body>
</html>

